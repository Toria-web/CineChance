# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ—Å—Ç–µ—Ä–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Ä–µ—à–µ–Ω–∞ —á–µ—Ä–µ–∑ Image Proxy, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–µ—Ä—ã –≤—Å–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –¥–æ–∂–∏–¥–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Image Proxy

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `/api/image-proxy/route.ts`:**
```typescript
// Redis –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
const redis = Redis.fromEnv();

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ TMDB
const cachedImage = await redis.get(cacheKey);
if (cachedImage) {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑ –∫—ç—à–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
  return new NextResponse(Buffer.from(data, 'base64'), {
    headers: { 'X-Cache': 'HIT' }
  });
}

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à –Ω–∞ 1 —á–∞—Å
await redis.setex(cacheKey, 3600, {
  data: base64Data,
  contentType: contentType
});
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- üîÑ **Fallback –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è Fanart.tv
- üìä **X-Cache headers** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### 2. –¢–∞–π–º–∞—É—Ç—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// 5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç –≤–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 5000);

const response = await fetch(imageUrl, {
  signal: controller.signal,
  // ...
});
```

### 3. –£–ª—É—á—à–µ–Ω–Ω—ã–π UX –≤ MoviePosterProxy

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `MoviePosterProxy.tsx`:**
```typescript
// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –º–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
const [showSlowLoadingWarning, setShowSlowLoadingWarning] = useState(false);

useEffect(() => {
  if (!isLoading) return;
  
  const timer = setTimeout(() => {
    if (isLoading && !imageLoaded) {
      setShowSlowLoadingWarning(true);
    }
  }, 3000);

  return () => clearTimeout(timer);
}, [isLoading, imageLoaded]);
```

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç:**
```typescript
{showSlowLoadingWarning && (
  <div className="text-center">
    <span className="text-gray-400 text-xs">–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞...</span>
    <button 
      onClick={() => setRetryCount(prev => prev + 1)}
      className="text-blue-400 text-xs hover:text-blue-300 underline"
    >
      –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
    </button>
  </div>
)}
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤

```typescript
// –°–Ω–∏–∂–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
quality={75} // –±—ã–ª–æ 85

// –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
sizes="(max-width: 640px) 40vw, (max-width: 768px) 30vw, ..."

// –ú–µ–Ω—å—à–µ retry –ø–æ–ø—ã—Ç–æ–∫
if (retryCount < 1) // –±—ã–ª–æ 2
```

### 5. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `MovieCard.tsx`:**
```typescript
interface MovieCardProps {
  // ...
  index?: number; // –î–æ–±–∞–≤–ª—è–µ–º index
}

// –ü–µ—Ä–≤—ã–µ 6 –ø–æ—Å—Ç–µ—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
priority={priority || index < 6}
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

### –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏:
- **–ü–µ—Ä–≤—ã–π —Ä–∞–∑**: ~3-5 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç TMDB)
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: ~100-500–º—Å (–∏–∑ Redis –∫—ç—à–∞)
- **Fallback –Ω–∞ Fanart**: ~2-3 —Å–µ–∫—É–Ω–¥—ã
- **Placeholder**: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

### UX —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –º–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ **–ö–Ω–æ–ø–∫–∞ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"** –¥–ª—è impatient –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** –ø–µ—Ä–≤—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤
- ‚úÖ **Cache headers** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### X-Cache Headers:
- `HIT` - –∏–∑ Redis –∫—ç—à–∞
- `MISS` - –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ TMDB
- `MISS-FALLBACK` - –∑–∞–ø—Ä–æ—Å –∫ Fanart.tv
- `PLACEHOLDER` - fallback –Ω–∞ placeholder

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```typescript
console.log('Cache hit for:', imageUrl);
console.log('Cache miss, fetching:', imageUrl);
```

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–±—É–¥—É—â–µ–µ)

### 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤
```typescript
// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–µ—Ä–≤—ã–µ 12 –ø–æ—Å—Ç–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
const preloadCriticalPosters = (posters: Media[]) => {
  posters.slice(0, 12).forEach(movie => {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = `/api/image-proxy?url=${encodeURIComponent(tmdbUrl)}`;
    document.head.appendChild(link);
  });
};
```

### 2. WebP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```typescript
// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WebP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
const convertToWebP = async (imageBuffer: ArrayBuffer) => {
  // WebP –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
};
```

### 3. CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```typescript
// –í—ã–≥—Ä—É–∑–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ—Å—Ç–µ—Ä—ã –≤ CDN
const cdnUrl = `https://cdn.cinechance.com/posters/${movie.id}.webp`;
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:
- ‚ö° **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏** –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ (Redis)
- üéØ **–ü–µ—Ä–≤—ã–µ –ø–æ—Å—Ç–µ—Ä—ã** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- üí¨ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç** –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
- üîÑ **–ú–æ–≥—É—Ç retry** –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- üìä **–ú–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ headers

**–ò—Ç–æ–≥: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω UX –∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–æ–≤!** üéâ

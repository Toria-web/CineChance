# –û—Ç—á–µ—Ç –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∑–≤–µ—à–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ Prisma
- **–§–∞–π–ª:** `prisma/schema.prisma`
- **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ:** `weightedRating Float?` –≤ –º–æ–¥–µ–ª—å `WatchList`
- **–î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å:** `@@index([weightedRating])` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–≤
- **–ö–æ–º–∞–Ω–¥–∞:** `npx prisma generate`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–∏–ø—ã Prisma –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –≤–∫–ª—é—á–∞—é—Ç –Ω–æ–≤–æ–µ –ø–æ–ª–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### 3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- **–ö–æ–º–∞–Ω–¥–∞:** `npm run build`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Å–±–æ—Ä–∫–∞, –Ω–µ—Ç –æ—à–∏–±–æ–∫
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –Ω–µ —Å–ª–æ–º–∞–Ω

### 4. SQL —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- **–§–∞–π–ª:** `prisma/migrations/add_weighted_rating.sql`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–∫–æ–≥–¥–∞ –ë–î –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞)

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ø—Ä–æ–¥–µ
```bash
psql $DATABASE_URL -f prisma/migrations/add_weighted_rating.sql
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```sql
SELECT COUNT(*) as total_records, 
       COUNT(weightedRating) as records_with_weighted_rating,
       COUNT(userRating) as records_with_user_rating
FROM "WatchList";
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á–µ—Ç–∞ –≤–∑–≤–µ—à–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫
- –û–±–Ω–æ–≤–∏—Ç—å API —Å fallback –ª–æ–≥–∏–∫–æ–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

- **Zero downtime:** –ü–æ–ª–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ nullable
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- **Fallback –ª–æ–≥–∏–∫–∞:** `weightedRating ?? userRating`
- **–û—Ç–∫–∞—Ç:** –õ–µ–≥–∫–æ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

## üìä –°—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| Prisma —Å—Ö–µ–º–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ | –ü–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ |
| –¢–∏–ø—ã TypeScript | ‚úÖ –ì–æ—Ç–æ–≤–æ | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã |
| –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ –ì–æ—Ç–æ–≤–æ | –ë–µ–∑ –æ—à–∏–±–æ–∫ |
| SQL —Å–∫—Ä–∏–ø—Ç | ‚úÖ –ì–æ—Ç–æ–≤–æ | –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω |
| –ü—Ä–æ–¥–∞–∫—à–Ω –ë–î | ‚è≥ –û–∂–∏–¥–∞–µ—Ç | –ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å |

**–ò—Ç–æ–≥:** –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –≤ –∫–æ–¥–µ.

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤

**–î–∞—Ç–∞:** 9 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å—Ç–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫—ç—à–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞..." –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä  
**–°—Ç–∞—Ç—É—Å:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ø–æ—Å—Ç–µ—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã (–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –∏–∑ Redis –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞), –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã.

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **Redis —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ö–†–ò–¢–ò–ß–ù–û)**
–ö–æ–≥–¥–∞ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ –æ–±—ä–µ–∫—Ç –≤ Redis:
```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
await redis.setex(cacheKey, ttl, {
  data: base64Data,
  contentType: 'image/jpeg'
});
```

Redis –º–æ–≥ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —ç—Ç–æ –∫–∞–∫ JSON —Å—Ç—Ä–æ–∫—É, –Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º—ã –æ–∂–∏–¥–∞–ª–∏ –æ–±—ä–µ–∫—Ç. Upstash Redis –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:** –Ø–≤–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –≤ JSON –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –ø–∞—Ä—Å–∏–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const payload = JSON.stringify({ data: base64Data, contentType });
await redis.setex(cacheKey, ttl, payload);

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
const cachedImage = await redis.get(cacheKey);
const cacheData = typeof cachedImage === 'string' ? JSON.parse(cachedImage) : cachedImage;
```

### 2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞ –≤ MoviePosterProxy**
Next.js Image –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç –Ω–µ –≤—ã–∑–≤–∞—Ç—å `onLoad` callback –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–∂–µ –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º –∫—ç—à–µ (HTTP cache-control).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä:
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º –∫—ç—à–µ
useEffect(() => {
  const checkBrowserCache = () => {
    const img = containerRef.current?.querySelector('img');
    if (img?.complete && img?.naturalHeight > 0) {
      handleImageLoad(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º loaded state
    }
  };
  
  checkBrowserCache();
  setTimeout(checkBrowserCache, 50);
}, [movie.id]);
```

### 3. **Cache-Control headers**
–ú–µ–Ω—è–ª–∞—Å—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ó–∞–ø—Ä–æ—Å—ã —Å `X-Cache: HIT` —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç `immutable` —Ñ–ª–∞–≥
- –í—Å–µ—Ö —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: `public, max-age=3600, immutable`

### 4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
- `üéØ Cache HIT` - –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ Redis –∫—ç—à
- `‚ùå Cache MISS` - –ø—Ä–æ–º–∞—Ö –∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞
- `üíæ Image cached` - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis
- `‚è±Ô∏è Rate limit exceeded` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `src/app/api/image-proxy/route.ts`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ Redis (–≤—Å–µ fallback —Å–ª—É—á–∞–∏)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ JSON –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ Redis
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è invalid cache data
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∫—ç—à–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã `immutable` —Ñ–ª–∞–≥–∏ –¥–ª—è Cache-Control headers

### `src/app/components/MoviePosterProxy.tsx`
- –î–æ–±–∞–≤–ª–µ–Ω `containerRef` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ DOM —ç–ª–µ–º–µ–Ω—Ç–∞–º
- –î–æ–±–∞–≤–ª–µ–Ω `useEffect` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∑–∞–≥—Ä—É–∑–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ loaded –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Cache MISS)
```
1. –ë—Ä–∞—É–∑–µ—Ä ‚Üí /api/image-proxy?url=...
2. image-proxy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Redis –∫—ç—à ("Cache MISS")
3. image-proxy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç rate limit (–ª–∏–º–∏—Ç –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç)
4. image-proxy fetch'–∏—Ç —Å TMDB (10s timeout)
5. image-proxy —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Redis (JSON.stringify)
6. image-proxy –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É (X-Cache: MISS)
7. –ë—Ä–∞—É–∑–µ—Ä –∫—ç—à–∏—Ä—É–µ—Ç –Ω–∞ 1 —á–∞—Å (max-age=3600)
8. MoviePosterProxy –≤—ã–∑—ã–≤–∞–µ—Ç onLoad ‚Üí imageLoaded=true –Ω–µ—Ç "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞"
```

### –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Cache HIT)
```
1. –ë—Ä–∞—É–∑–µ—Ä ‚Üí /api/image-proxy?url=...
2. image-proxy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Redis –∫—ç—à ("Cache HIT")
3. image-proxy JSON.parse() –¥–∞–Ω–Ω—ã–µ
4. image-proxy –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É (X-Cache: HIT)
5. –ë—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP –∫—ç—à (max-age –µ—â—ë –∞–∫—Ç—É–∞–ª–µ–Ω)
6. Next.js Image –≤—ã–∑—ã–≤–∞–µ—Ç onLoad –∏–ª–∏ –Ω–∞—à useEffect –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç complete=true
7. MoviePosterProxy –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ loaded state ‚Üí –Ω–µ—Ç "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞"
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –í –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
```javascript
// –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Console
// –ë—É–¥–µ—Ç–µ –≤–∏–¥–µ—Ç—å –ª–æ–≥–∏:
// üéØ Cache HIT for image-proxy: https://image.tmdb.org/...
// üì¶ Returning cached image: { size: 45000, contentType: "image/jpeg" }
```

### Network —Ç–∞–± –≤ DevTools
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `X-Cache: HIT` —Ö–µ–¥–µ—Ä
- Response –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ–π (< 100ms)
- Status should be 200 (–Ω–µ 429 Rate Limit)

### Server –ª–æ–≥–∏ (npm run dev)
```
üéØ Cache HIT for image-proxy: https://image.tmdb.org/t/p/w500/abc123...
üíæ Returning cached image: { size: 75000, contentType: "image/jpeg" }
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ï—Å–ª–∏ Redis –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
echo $UPSTASH_REDIS_REST_URL
echo $UPSTASH_REDIS_REST_TOKEN

# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
‚ùå Redis cache check failed: [error message]
# –ù–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±—É–¥–µ—Ç –±–µ–∑ Redis (slower, –±–µ–∑ –∫—ç—à–∞)
```

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –µ—â–µ –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å–ª–∏ "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è:

1. **Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å UPSTASH_REDIS_REST_URL –∏ TOKEN –≤ .env.local
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ Redis –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: `getRedisClient()` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å !== null

2. **TMDB API –º–µ–¥–ª–µ–Ω–Ω—ã–π:**
   - image-proxy –∏–º–µ–µ—Ç 10 —Å–µ–∫ timeout –¥–ª—è TMDB
   - –ï—Å–ª–∏ TMDB –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ, –±—É–¥–µ—Ç fallback –Ω–∞ FANART_TV (3 —Å–µ–∫)

3. **Rate limit –¥–æ—Å—Ç–∏–≥–Ω—É—Ç:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–ª—è "RATE_LIMITED" —Å–æ–æ–±—â–µ–Ω–∏–π
   - –õ–∏–º–∏—Ç: 300 req/min –Ω–∞ /api/image-proxy
   - –ü–æ—Å—á–∏—Ç–∞—Ç—å: 20 —Ñ–∏–ª—å–º–æ–≤ √ó 2 –ø–æ–ø—ã—Ç–∫–∏ = 40 req –∑–∞ –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

4. **Browser cache –ø—Ä–æ–±–ª–µ–º—ã:**
   - –û—á–∏—Å—Ç–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫—ç—à: DevTools ‚Üí Application ‚Üí Clear site data
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `max-age` –Ω–µ —Ä–∞–≤–µ–Ω 0

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. Commit –∏ push –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. Deploy –Ω–∞ Vercel
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ Vercel:
   ```bash
   vercel logs
   ```
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network —Ç–∞–± –≤ –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ production

## Metrics

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- `X-Cache: HIT` –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å < 50ms
- `X-Cache: MISS` –æ—Ç–≤–µ—Ç—ã 5-10 —Å–µ–∫ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç TMDB)
- –ù–µ—Ç "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –ø–æ—Å—Ç–µ—Ä–æ–≤
- Redis —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç ~100-200 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –ø—Ä–æ–±–ª–µ–º

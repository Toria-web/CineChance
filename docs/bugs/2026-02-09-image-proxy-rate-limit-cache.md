# Image-Proxy: Rate Limiting –¥–æ –∫–µ—à–∞ –ª–æ–º–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å—Ç–µ—Ä–æ–≤

**–î–∞—Ç–∞:** 2026-02-09
**–°—Ç–∞—Ç—É—Å:** ‚úÖ FIXED
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ñ–∏–ª—å–º–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ—à–∏–±–∫–∏ 429 (Too Many Requests) –≤ –ª–æ–≥–∞—Ö rate limiting:

```
Rate limit exceeded for ip:93.92.204.252 on default. Limit: 100, Remaining: 0
GET /api/image-proxy?url=https%3A%2F%2Fimage.tmdb.org%2Ft%2Fp%2Fw500%2F... 429 in 8ms
```

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–í `src/app/api/image-proxy/route.ts` rate limiting –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–î–û** –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞:

```typescript
export async function GET(req: Request) {
  const { success } = await rateLimit(req, 'default');  // ‚Üê –ó–¥–µ—Å—å!
  if (!success) {
    return NextResponse.json({ error: 'Too Many Requests' }, { status: 429 });
  }

  // ... —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–µ—à
  const cachedImage = await redis.get(cacheKey);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ image-proxy (–¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Å—Ç–µ—Ä –∫–µ—à–∏—Ä–æ–≤–∞–Ω) —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ –ª–∏–º–∏—Ç
- –õ–∏–º–∏—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`endpointLimits['default']`) = 100 req/min
- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 10-20 –ø–æ—Å—Ç–µ—Ä–æ–≤ ‚Üí –ª–µ–≥–∫–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç—Å—è –ª–∏–º–∏—Ç
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã **–Ω–µ –¥–æ–ª–∂–Ω—ã** —Å—á–∏—Ç–∞—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç

## –†–µ—à–µ–Ω–∏–µ

–ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É rate limiting **–ø–æ—Å–ª–µ** –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞:
1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º Redis –∫–µ—à (–±–µ–∑ –ª–∏–º–∏—Ç–∞)
2. –ï—Å–ª–∏ –µ—Å—Ç—å –≤ –∫–µ—à–µ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º (–ª–∏–º–∏—Ç –Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è)
3. –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º rate limit
4. –ï—Å–ª–∏ –ª–∏–º–∏—Ç –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º —Å TMDB

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ rate limiting, —Ç.–∫. –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ—Å—Ç–µ—Ä–æ–≤ –±—É–¥—É—Ç –∏–∑ –∫–µ—à–∞.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–æ—Ç–∫–ª–æ–Ω–µ–Ω—ã)

### ‚ùå –ò—Å–∫–ª—é—á–∏—Ç—å image-proxy –∏–∑ rate limiting
- **–ú–∏–Ω—É—Å:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DDoS-–∞—Ç–∞–∫ –Ω–∞ –ø—Ä–æ–∫—Å–∏
- **–í—ã–≤–æ–¥:** –õ–∏–º–∏—Ç –Ω—É–∂–µ–Ω, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### ‚ùå –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –¥–ª—è image-proxy
- **–ú–∏–Ω—É—Å:** –í—Å–µ —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞, –µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–µ—Ä–æ–≤
- **–í—ã–≤–æ–¥:** –ö–µ—à-–ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥ –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª–µ–Ω

## –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É rate limiting –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞ –≤ [src/app/api/image-proxy/route.ts](src/app/api/image-proxy/route.ts).

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ñ–∏–ª—å–º–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ 429 –æ—à–∏–±–æ–∫
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Cache-Control —Ö–µ–¥–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç `X-Cache: HIT` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ rate limit (`/api/any-other-endpoint`) –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## Impact

- ‚úÖ –ü–æ—Å—Ç–µ—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ rate limiting
- ‚úÖ –õ—É—á—à–µ UX (–Ω–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –±—ã—Å—Ç—Ä—ã–º

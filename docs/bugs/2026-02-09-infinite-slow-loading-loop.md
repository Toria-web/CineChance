# Infinite "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" loop + Aggressive HTTP caching —É–±–∏–≤–∞–µ—Ç –≤—Å–µ –ø–æ—Å—Ç–µ—Ä—ã

**–î–∞—Ç–∞:** 2026-02-09
**–°—Ç–∞—Ç—É—Å:** ‚úÖ FIXED
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

## –ü—Ä–æ–±–ª–µ–º–∞

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ó–∞—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Üí –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ—Å—Ç–µ—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ, 2-3 –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ("–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞")
2. –ò–¥–µ–º –Ω–∞ "–ú–æ–∏ —Ñ–∏–ª—å–º—ã" ‚Üí –≤—Å–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (–≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–µ —Ñ–∏–ª—å–º—ã)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é ‚Üí **–í–°–ï –ø–æ—Å—Ç–µ—Ä—ã –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞"
4. –°–∏—Ç—É–∞—Ü–∏—è –Ω–µ —É–ª—É—á—à–∞–µ—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª–∏–∫–∞—Ç—å "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"

### –°–∏–º–ø—Ç–æ–º—ã
- –ü–æ—Å—Ç–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è/–Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ
- Placeholder –∏–ª–∏ "–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞" –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å
- –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∞ –ø–æ–ø—ã—Ç–∫–∏

## –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1Ô∏è‚É£ Aggressive HTTP caching placeholder –æ–±—Ä–∞–∑–æ–≤

–í `src/app/api/image-proxy/route.ts`:

```typescript
return new NextResponse(placeholderBuffer, {
  headers: {
    'Cache-Control': 'public, max-age=86400',  // ‚Üê 24 –ß–ê–°–ê!
  }
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ï—Å–ª–∏ –ø–æ—Å—Ç–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è placeholder SVG
- **–ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç placeholder –Ω–∞ 24 —á–∞—Å–∞!**
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–∑–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç placeholder –∏–∑ –∫–µ—à–∞, –Ω–µ –¥–µ–ª–∞—è –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- –ï—Å–ª–∏ –ø–µ—Ä–µ–µ–∑ –Ω–∞ ISR –æ–±–Ω–æ–≤–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–∞—Ö –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –Ω–æ–≤—ã–µ —Ñ–∏–ª—å–º—ã —Ç–æ–∂–µ –ø–æ–ª—É—á–∞—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—à–∏–±–∫—É

### 2Ô∏è‚É£ Rate limit –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤–º–µ—Å—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```typescript
if (!success) {
  return NextResponse.json({ error: 'Too Many Requests' }, { status: 429 });
}
```

–ë—Ä–∞—É–∑–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç JSON, –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞–∫ –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí –æ—à–∏–±–∫–∞ ‚Üí handlePosterError ‚Üí retry ‚Üí –µ—â–µ JSON ‚Üí –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª

### 3Ô∏è‚É£ –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π rate limit (500 req/min)

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 20 —Ñ–∏–ª—å–º–æ–≤ + retry –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –ø—Ä–µ–≤—ã—Å–∏—Ç—å 500 req/min –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

### 4Ô∏è‚É£ Fallbackimage —Ç–∞–∫–∂–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞

–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π URL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –≤–∞—Ä–∏–∞–Ω—Ç, –æ–Ω —Ç–æ–∂–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫, –±–ª–æ–∫–∏—Ä—É—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

## –†–µ—à–µ–Ω–∏–µ

### 1. –ù–µ –∫–µ—à–∏—Ä—É–µ–º placeholder –∏ fallback (image-proxy)

```typescript
return new NextResponse(placeholderBuffer, {
  headers: {
    'Cache-Control': 'no-cache, no-store, must-revalidate',
    'Pragma': 'no-cache',
    'Expires': '0',
    // ‚Üê –ë—Ä–∞—É–∑–µ—Ä –ù–ï –∫–µ—à–∏—Ä—É–µ—Ç, –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫–∞–∂–¥—ã–π —Ä–∞–∑
  },
});
```

### 2. –í–æ–∑–≤—Ä–∞—â–∞–µ–º SVG –≤–º–µ—Å—Ç–æ JSON –ø—Ä–∏ rate limit

```typescript
if (!success) {
  const placeholderSvg = '...rate limit SVG...';
  return new NextResponse(placeholderBuffer, {
    status: 200, // –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç —É—Å–ø–µ—Ö (–Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è retry –∫–∞–∫ –ø—Ä–∏ 429)
    headers: {
      'Cache-Control': 'no-cache, no-store, must-revalidate',
      'Content-Type': 'image/svg+xml',
    },
  });
}
```

### 3. –£–º–µ–Ω—å—à–∞–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–µ—à –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
'Cache-Control': 'public, max-age=3600'  // 1 —á–∞—Å –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤
```

–ë—Ä–∞—É–∑–µ—Ä –ø–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ —á–∞—Å, —á—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å—Ç–µ—Ä—ã –µ—Å–ª–∏ –±—ã–ª–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### 4. –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º rate limit –¥–ª—è image-proxy

```typescript
'/api/image-proxy': { points: 1000, duration: 60 }  // –±—ã–ª–æ 500
```

1000 req/min –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ retry

### 5. –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ retry (MoviePosterProxy)

–ü—Ä–∏ –∫–ª–∏–∫–µ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞":
```typescript
setImageLoaded(false);
setShowSlowLoadingWarning(false);
setRetryCount(prev => prev + 1);
```

–¢–∞–π–º–µ—Ä –≤ 3 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [src/app/api/image-proxy/route.ts](src/app/api/image-proxy/route.ts)
  - –ù–µ –∫–µ—à–∏—Ä—É–µ–º placeholder –∏ fallback
  - –í–æ–∑–≤—Ä–∞—â–∞–µ–º SVG –≤–º–µ—Å—Ç–æ JSON –ø—Ä–∏ rate limit
  - –£–º–µ–Ω—å—à–∞–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–µ—à (24h ‚Üí 1h)
  
- [src/middleware/rateLimit.ts](src/middleware/rateLimit.ts)
  - –£–≤–µ–ª–∏—á–µ–Ω –ª–∏–º–∏—Ç –¥–ª—è image-proxy (500 ‚Üí 1000 req/min)
  
- [src/app/components/MoviePosterProxy.tsx](src/app/components/MoviePosterProxy.tsx)
  - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ retry

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é:**
   - –ü–æ—Å—Ç–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ‚Üí –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 1 —á–∞—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - Placeholder –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å –æ—à–∏–±–∫–∞
   - Placeholder –ù–ï –∫–µ—à–∏—Ä—É–µ—Ç—Å—è ‚Üí –±—Ä–∞—É–∑–µ—Ä –ø–æ–≤—Ç–æ—Ä–∏—Ç —á–µ—Ä–µ–∑ 1 —Å–µ–∫‚Äã—É–Ω–¥—É

2. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤–æ–∑–≤—Ä–∞—Ç:**
   - –ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –∏–∑ –∫–µ—à–∞ (OK, –¥–æ 1 —á–∞—Å–∞)
   - –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 1 —á–∞—Å–∞ ‚Üí –±—Ä–∞—É–∑–µ—Ä –ø–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å
   - Placeholder –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–∫–µ—à–∏—Ä—É–µ—Ç—Å—è

3. **Rate limit —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
   - –í–º–µ—Å—Ç–æ JSON –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è SVG placeholder
   - –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç "—É—Å–ø–µ—à–Ω–æ–µ" –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è retry –∫–∞–∫ –ø—Ä–∏ 429)
   - –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ rate limit –º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```bash
   curl -i http://localhost:3000/api/image-proxy?url=...
   # –°–º–æ—Ç—Ä–∏–º Cache-Control header
   # –î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ: public, max-age=3600
   # –î–ª—è placeholder: no-cache, no-store, must-revalidate
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å retry:**
   - –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –≥–ª–∞–≤–Ω—É—é
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–Ω–µ –∏–∑ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞)

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å rate limit:**
   - Rapidfire ~150-200 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ image-proxy
   - –î–æ–ª–∂–Ω—ã –≤–∏–∂—É SVG placeholder (–Ω–µ JSON 429)
   - –ü–æ—Å—Ç–µ—Ä—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (–∫–æ–Ω–µ—á–Ω–æ, –∫–∞–∫ placeholder)

## –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ

- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –∫–µ—à–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ (placeholder, fallback) –Ω–∞–¥–æ–ª–≥–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `no-cache, no-store, must-revalidate` –¥–ª—è –ª—é–±—ã—Ö –æ—à–∏–±–æ–∫ –∏–ª–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–∞–ª–∏–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (SVG) –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ (JSON/5xx)
- –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ rate limit –∏ network errors
- Rate limit –¥–ª—è image-proxy –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —â–µ–¥—Ä—ã–º (1000+ req/min), —Ç.–∫. –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ö–∏—Ç—è—Ç –∫–µ—à Redis

# –£–ª—å—Ç–∏–º–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ—Å—Ç–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Image Proxy

## –ü—Ä–æ–±–ª–µ–º–∞

–í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ—à–µ–Ω–∏—è (Next.js Image –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã) –Ω–µ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö Android Chrome.

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, –∫–∞–∫ –º–æ–±–∏–ª—å–Ω—ã–π Chrome –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–∏–º –¥–æ–º–µ–Ω–∞–º (TMDB, Fanart.tv). –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∫—ç—à –º–æ–±–∏–ª—å–Ω–æ–≥–æ Chrome
- –°–µ—Ç–µ–≤—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

## –£–ª—å—Ç–∏–º–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: Image Proxy

–°–æ–∑–¥–∞–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ —ç—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

### 1. Image Proxy API (`/api/image-proxy/route.ts`)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å —Å–µ—Ä–≤–µ—Ä–∞ (–æ–±—Ö–æ–¥—è CORS)
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ User-Agent –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ fallback
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

```typescript
// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
/api/image-proxy?url=https://image.tmdb.org/t/p/w500/poster.jpg
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Server-side –∑–∞–ø—Ä–æ—Å—ã** - –æ–±—Ö–æ–¥–∏–º CORS
- **Custom User-Agent** - –∏–º–∏—Ç–∏—Ä—É–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä
- **Cache-Control** - —É–ø—Ä–∞–≤–ª—è–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **Fallback –ª–æ–≥–∏–∫–∞** - –ø—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- **CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏** - —Ä–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ –¥–æ–º–µ–Ω–∞

### 2. MoviePosterProxy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—à –ø—Ä–æ–∫—Å–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö URL:

```typescript
const getProxyUrl = () => {
  const tmdbUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : null;
  return `/api/image-proxy?url=${encodeURIComponent(tmdbUrl)}`;
};
```

### 3. –£–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–±–æ—Ä–∞

```typescript
const getPosterStrategy = () => {
  const useProxy = process.env.NEXT_PUBLIC_USE_IMAGE_PROXY === 'true';
  const useFallback = isMobileDevice() || process.env.NEXT_PUBLIC_USE_FALLBACK_POSTER === 'true';
  
  if (useProxy) return 'proxy';      // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø—Ä–æ–∫—Å–∏
  if (useFallback) return 'fallback'; // Fallback: –Ω–∞—Ç–∏–≤–Ω—ã–π img
  return 'default';                  // –û—Ä–∏–≥–∏–Ω–∞–ª: Next.js Image
};
```

### 4. Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
NEXT_PUBLIC_USE_IMAGE_PROXY=true

# Fallback –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∫—Å–∏
NEXT_PUBLIC_USE_FALLBACK_POSTER=true
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Image Proxy

### 1. –û–±—Ö–æ–¥ CORS
- –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±—ã—Ö –¥–æ–º–µ–Ω–æ–≤

### 2. –ö–æ–Ω—Ç—Ä–æ–ª—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ø—Ä–∞–≤–ª—è–µ–º headers –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –û–±—Ö–æ–¥–∏–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∫—ç—à Chrome
- Cache busting —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### 3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- Retry –ª–æ–≥–∏–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- Fallback –Ω–∞ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- Graceful degradation

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç** `/api/image-proxy?url=...`
2. **–°–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç** –∑–∞–ø—Ä–æ—Å –∫ TMDB/Fanart
3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç** —Å –Ω—É–∂–Ω—ã–º–∏ headers
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** –∫–ª–∏–µ–Ω—Ç—É
5. **Next.js Image** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞—à –ø—Ä–æ–∫—Å–∏ URL

## Rollback –ø–ª–∞–Ω

–ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –≤—ã–∑–æ–≤–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –û—Ç–∫–ª—é—á–∏—Ç—å: `NEXT_PUBLIC_USE_IMAGE_PROXY=false`
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ fallback
3. –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö

```typescript
const getPosterStrategy = () => {
  const useProxy = isMobileDevice() && process.env.NEXT_PUBLIC_USE_IMAGE_PROXY === 'true';
  // ...
};
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π hop** - –Ω–µ–±–æ–ª—å—à–æ–π overhead
- **–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Redis
- **CDN** - –º–æ–∂–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ CDN
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç abuse
- **URL –≤–∞–ª–∏–¥–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
- **Content-Type –ø—Ä–æ–≤–µ—Ä–∫–∞** - —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–†–∞–∑–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ** - –∑–∞—â–∏—Ç–∞ –æ—Ç DoS

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ü—Ä–æ–∫—Å–∏ –≤–∫–ª—é—á–µ–Ω** - –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤–µ–∑–¥–µ
2. **–ü—Ä–æ–∫—Å–∏ –æ—Ç–∫–ª—é—á–µ–Ω** - fallback –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–π img
3. **–û–±–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π Next.js Image
4. **–û—à–∏–±–∫–∏ –ø—Ä–æ–∫—Å–∏** - graceful fallback

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ** —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–µ—Ä–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ö–æ–¥–∏—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–∫—Å–∏.

**–£—Å–ø–µ—Ö = –ü–æ—Å—Ç–µ—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–µ–∑–¥–µ! üéØ**

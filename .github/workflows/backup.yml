name: Test Yandex Disk API

on:
  workflow_dispatch

jobs:
  test-yandex-disk:
    runs-on: ubuntu-latest

    steps:
      - name: Create test file
        run: |
          echo "Test from GitHub Actions - $(date)" > test_file.txt
          echo "Timestamp: $(date +%Y%m%d_%H%M%S)" >> test_file.txt
          cat test_file.txt

      - name: Upload to Yandex Disk via API
        run: |
          TOKEN="${{ secrets.YANDEX_DISK_TOKEN }}"
          FILENAME="test_file.txt"
          UPLOAD_URL="https://cloud-api.yandex.net/v1/disk/resources/test_file.txt"

          # Загружаем файл через Yandex Disk API
          echo "=== Uploading $FILENAME to Yandex Disk ==="
          curl -X PUT \
            -H "Authorization: OAuth $TOKEN" \
            -H "Content-Type: application/octet-stream" \
            --data-binary @"$FILENAME" \
            "$UPLOAD_URL" \
            -v 2>&1 | head -50

      - name: Check if file exists
        run: |
          TOKEN="${{ secrets.YANDEX_DISK_TOKEN }}"
          CHECK_URL="https://cloud-api.yandex.net/v1/disk/resources/test_file.txt"

          echo "=== Checking file ==="
          curl -H "Authorization: OAuth $TOKEN" "$CHECK_URL" 2>/dev/null | head -10
